model SharedDocument {
  id          String          @id @default(cuid())
  employerId  String
  candidateId String
  filename    String
  url         String
  status      String @default("SHARED")
  auditTrail  String? // JSON string: [{action, by, at}]
  sentAt      DateTime        @default(now())
  signedAt    DateTime?
  returnedAt  DateTime?

  employer  EmployerProfile  @relation(fields: [employerId], references: [id])
  candidate CandidateProfile @relation(fields: [candidateId], references: [id])
}

// Enums removed for SQLite compatibility; use string fields instead

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "sqlite"
  url      = env("DATABASE_URL")
}

model User {
  id                        String               @id @default(cuid())
  email                     String               @unique
  password                  String
  emailVerified             DateTime?
  role                      String               @default("CANDIDATE")
  createdAt                 DateTime             @default(now())
  updatedAt                 DateTime             @updatedAt
  candidateCandidateProfile CandidateProfile?    @relation("UserCandidate")
  employerEmployerProfile   EmployerProfile?     @relation("UserEmployer")
  verificationTokens        VerificationToken[]  @relation("UserVerificationTokens")
  passwordResetTokens       PasswordResetToken[] @relation("UserPasswordResetTokens")
  accounts                  Account[]
}

model CandidateProfile {
  id               String          @id @default(cuid())
  userId           String          @unique
  fullName         String
  jobTitle         String?
  summary          String?
  yearsExperience  Int?
  sector           String?
  personalityType  String?
  personalityDesc  String?
  availability     String          @default("AVAILABLE_IMMEDIATE")
  dayRate          Int?
  salaryExpectation Int?
  location         String?
  email            String?
  phone            String?
  remotePreference String?         @default("remote")
  employmentType   String?         @default("contract")
  rightToWork      String?
  cvUrl            String?
  videoUrl         String?
  videoIntroUrl    String?
  profilePhotoUrl  String?
  linkedinUrl      String?
  portfolioUrl     String?
  githubUrl        String?
  twitterUrl       String?
  websiteUrl       String?
  isPublic         Boolean         @default(true)
  showSalary       Boolean         @default(false)
  showProfilePhoto Boolean         @default(true)
  anonymousMode    Boolean         @default(false)
  completionStyle  String          @default("both") // ring, bar, both
  createdAt        DateTime        @default(now())
  updatedAt        DateTime        @updatedAt

  skills           Skill[]
  certifications   Certification[]
  experiences      Experience[]
  education        Education[]
  documents        Document[]
  savedBy          SavedCandidate[]
  sharedDocuments  SharedDocument[]
  applications     Application[]
  conversations    Conversation[]
  activityLogs     ActivityLog[]

  user User @relation("UserCandidate", fields: [userId], references: [id])
}

model Document {
  id           String   @id @default(cuid())
  candidateId  String
  filename     String
  url          String
  title        String?
  fileSize     Int?
  documentType String   @default("other") // cv, certificate, other
  isPublic     Boolean  @default(false)
  uploadedAt   DateTime @default(now())

  candidate CandidateProfile @relation(fields: [candidateId], references: [id])
}

model EmployerProfile {
  id          String   @id @default(cuid())
  userId      String   @unique
  companyName String?
  contactName String?
  website     String?
  phone       String?
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  user            User             @relation("UserEmployer", fields: [userId], references: [id])
  savedCandidates SavedCandidate[]
  sharedDocuments SharedDocument[]
  jobs            Job[]
  conversations   Conversation[]
  activityLogs    ActivityLog[]
}

model Skill {
  id           String           @id @default(cuid())
  candidateId  String
  name         String
  proficiency  String           @default("Intermediate") // Beginner, Intermediate, Advanced, Expert
  category     String           @default("Other")
  createdAt    DateTime         @default(now())

  candidate CandidateProfile @relation(fields: [candidateId], references: [id])
}

model Certification {
  id              String           @id @default(cuid())
  candidateId     String
  title           String
  issuingBody     String
  issueDate       DateTime?
  expiryDate      DateTime?
  credentialId    String?
  verificationUrl String?
  createdAt       DateTime         @default(now())

  candidate CandidateProfile @relation(fields: [candidateId], references: [id])
}

model Experience {
  id           String           @id @default(cuid())
  candidateId  String
  jobTitle     String
  company      String
  location     String?
  startDate    DateTime
  endDate      DateTime?
  current      Boolean          @default(false)
  description  String?
  achievements String?
  projectType  String?
  projectValue String?
  teamSize     String?
  createdAt    DateTime         @default(now())

  candidate CandidateProfile @relation(fields: [candidateId], references: [id])
}

model Education {
  id           String           @id @default(cuid())
  candidateId  String
  institution  String
  degree       String
  fieldOfStudy String?
  grade        String?
  startDate    DateTime?
  endDate      DateTime?
  current      Boolean          @default(false)
  description  String?
  createdAt    DateTime         @default(now())

  candidate CandidateProfile @relation(fields: [candidateId], references: [id])
}

model SavedCandidate {
  id          String   @id @default(cuid())
  employerId  String
  candidateId String
  createdAt   DateTime @default(now())

  employer  EmployerProfile  @relation(fields: [employerId], references: [id])
  candidate CandidateProfile @relation(fields: [candidateId], references: [id])
}

model VerificationToken {
  id        String   @id @default(cuid())
  token     String   @unique
  userId    String
  expiresAt DateTime
  createdAt DateTime @default(now())

  user User @relation("UserVerificationTokens", fields: [userId], references: [id])
}

model PasswordResetToken {
  id        String   @id @default(cuid())
  token     String   @unique
  userId    String
  expiresAt DateTime
  createdAt DateTime @default(now())

  user User @relation("UserPasswordResetTokens", fields: [userId], references: [id])
}

// NextAuth Account model for linking OAuth providers
model Account {
  id                String   @id @default(cuid())
  userId            String
  type              String
  provider          String
  providerAccountId String
  refresh_token     String?
  access_token      String?
  expires_at        Int?
  token_type        String?
  scope             String?
  id_token          String?
  session_state     String?

  user User @relation(fields: [userId], references: [id])
  @@unique([provider, providerAccountId])
}

model ContactSubmission {
  id        String   @id @default(cuid())
  firstName String
  lastName  String
  email     String
  phone     String?
  company   String?
  jobTitle  String?
  userType  String   // CANDIDATE, EMPLOYER, OTHER
  subject   String
  message   String
  status    String   @default("NEW") // NEW, IN_PROGRESS, RESOLVED
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model Job {
  id            String   @id @default(cuid())
  employerId    String
  title         String
  description   String
  location      String?
  employmentType String? // CONTRACT, PERMANENT
  isRemote      Boolean  @default(false)
  shortDescription String?
  salaryMin     Int?
  salaryMax     Int?
  currency      String?
  isFeatured    Boolean  @default(false)
  isUrgent      Boolean  @default(false)
  specialism    String?
  seniority     String?
  paused        Boolean  @default(false)
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt

  employer EmployerProfile @relation(fields: [employerId], references: [id])
  applications Application[]
  activityLogs ActivityLog[]
}

model Application {
  id           String   @id @default(cuid())
  jobId        String
  candidateId  String
  coverLetter  String?
  availability String?
  cvUrl        String?
  status       String   @default("APPLIED") // APPLIED, REVIEWED, SHORTLISTED, REJECTED, INTERVIEW, OFFER, HIRED
  matchScore   Int?
  yearsExp     Int?
  location     String?
  answersJson  String? // JSON: screening answers
  attachments  String? // JSON: [{type, title, url, size}]
  viewedByEmployerAt DateTime?
  createdAt    DateTime @default(now())

  job       Job             @relation(fields: [jobId], references: [id])
  candidate CandidateProfile @relation(fields: [candidateId], references: [id])
  statusHistory ApplicationStatusHistory[]
  activities    ActivityLog[]
}

model ApplicationStatusHistory {
  id             String   @id @default(cuid())
  applicationId  String
  fromStatus     String?
  toStatus       String
  note           String?
  changedByUserId String
  createdAt      DateTime @default(now())

  application Application @relation(fields: [applicationId], references: [id])
}

model Conversation {
  id            String   @id @default(cuid())
  jobId         String?
  employerId    String
  candidateId   String
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt

  employer  EmployerProfile  @relation(fields: [employerId], references: [id])
  candidate CandidateProfile @relation(fields: [candidateId], references: [id])
  messages  Message[]
}

model Message {
  id              String   @id @default(cuid())
  conversationId  String
  senderUserId    String
  receiverUserId  String
  text            String?
  attachments     String? // JSON: [{url, name, type, size}]
  readAt          DateTime?
  createdAt       DateTime @default(now())

  conversation Conversation @relation(fields: [conversationId], references: [id])
}

model ActivityLog {
  id            String   @id @default(cuid())
  actorUserId   String
  employerId    String?
  candidateId   String?
  jobId         String?
  applicationId String?
  type          String   // APPLICATION_STATUS_CHANGED, APPLICATION_VIEWED, MESSAGE_SENT, PROFILE_VIEWED, etc
  details       String?  // JSON payload
  createdAt     DateTime @default(now())

  employer   EmployerProfile?  @relation(fields: [employerId], references: [id])
  candidate  CandidateProfile? @relation(fields: [candidateId], references: [id])
  job        Job?              @relation(fields: [jobId], references: [id])
  application Application?     @relation(fields: [applicationId], references: [id])
}

// Role and Availability enums removed for SQLite compatibility; use string fields instead
